<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <!--Utilidades-->
    <style>
      .card-header {
        background-color: #f8f9fa;
        font-weight: 600;
      }
      .form-control[disabled] {
        background-color: #e9ecef;
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <!--Navbar-->
    <nav class="navbar navbar-expand bg-black navbar-dark">
      <div class="container justify-content-center">
        <div class="navbar-nav">
          <a class="nav-link px-3 d-flex align-items-center" href="inicio.html">
            <i class="bi bi-house me-2"></i> Inicio
          </a>
          <a
            class="nav-link px-3 d-flex align-items-center"
            href="transacciones.html"
          >
            <i class="bi bi-credit-card me-2"></i> Transacciones
          </a>
          <a class="nav-link px-3 d-flex align-items-center" href="perfil.html">
            <i class="bi bi-person me-2"></i> Perfil
          </a>
        </div>
      </div>
    </nav>
    <!--Fin de Navbar-->

    <main class="d-flex align-items-center justify-content-center">
      <div class="container mt-4" id="card">
        <div class="row mb-3">
          <div class="col">
            <h2 id="bienvenida">¡Bienvenido A Tu Perfil!</h2>
          </div>
          <div class="col text-end">
            <button class="btn btn-danger" onclick="cerrarSesion()">
              <i class="bi bi-box-arrow-right me-1"></i> Cerrar Sesión
            </button>
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-center">
          <!-- Información básica -->
          <div class="col-md-4">
            <div
              class="card rounded-lg overflow-hidden"
              style="
                background-image: url('https://picsum.photos/800');
                background-repeat: no-repeat;
                background-size: cover;
              "
            >
              <div
                class="card-body text-center rounded-lg overflow-hidden"
                style="
                  backdrop-filter: blur(10px);
                  padding-top: 10rem;
                  padding-bottom: 10rem;
                "
              >
                <div
                  class="py-5 overflow-hidden"
                  style="
                    border-radius: 18px;
                    background-color: rgba(240, 240, 240, 0.6);
                  "
                >
                  <h3
                    class="mb-4"
                    id="nombre-usuario"
                    style="mix-blend-mode: multiply"
                  >
                    Nombre Usuario
                  </h3>

                  <!--Rol-->
                  <div class="d-flex flex-row justify-content-center gap-2">
                    <p
                      class="text-muted"
                      id="rol"
                      style="mix-blend-mode: multiply"
                    ></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!--Confirmacion-->
    <div class="modal fade" id="modalConfirmacion" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">¿Estás seguro que deseas cerrar sesión?</div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="btnConfirmarCerrar"
            >
              Cerrar Sesión
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      //Función para cerrar sesión
      function cerrarSesion() {
        const modalConfirmacion = new bootstrap.Modal(
          document.getElementById("modalConfirmacion")
        );
        modalConfirmacion.show();

        document.getElementById("btnConfirmarCerrar").onclick = function () {
          localStorage.removeItem("usuario");
          window.location.href = "index.html";
        };
      }

      //Función para cargar la información de perfil desde el usuario guardado en LocalStorage duarante el Login
      async function cargarPerfilDesdeLocalStorage() {
        //Valor correspondiente a "usuario" en localStorage
        const usuarioStr = localStorage.getItem("usuario");

        //Si no existe, retornar
        if (!usuarioStr) return;

        //Parsear la cadena de localStorage para devolver a JSON
        const usuario = JSON.parse(usuarioStr);
        console.log(usuario);

        //Renderizar contenido
        document.getElementById("nombre-usuario").textContent = usuario.User;
        document.getElementById("rol").textContent =
          usuario.Rol.split("")[0].toUpperCase() +
          usuario.Rol.split("").slice(1).join("");

        obtenerImagenAleatoria();
      }

      //Obtener imagen aleatoria
      async function obtenerImagenAleatoria() {
        const RANDOM_IMAGE_URL = "https://picsum.photos/200";
        const fondoCard = document.getElementById("card");

        const res = await fetch(RANDOM_IMAGE_URL);

        //Si no se pudo obtener imagen aleatoria, generar fondo aleatorio
        if (!res.ok) {
          const min = 240;
          const max = 255;

          const red = Math.floor(Math.random() * (max - min + 1)) + min;
          const blue = Math.floor(Math.random() * (max - min + 1)) + min;
          const green = Math.floor(Math.random() * (max - min + 1)) + min;

          fondoCard.style.backgroundColor();
        }

        //De lo contrario, colocar imagen como background image a 10% de opacidad
        const reader = await res.body.getReader();
        console.log(reader);

        const img = reader.read();
      }

      // Ejecutar al cargar la página
      window.addEventListener(
        "DOMContentLoaded",
        cargarPerfilDesdeLocalStorage
      );
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
